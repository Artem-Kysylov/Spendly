# Правила работы с JSON локалями (база: uk.json / ru.json)

Цель: обеспечить единообразную структуру локалей, исключить поломки и ситуации, когда в UI появляются “ключи с точками” вместо перевода.

## Базовые принципы

- Каноническая структура: форма и вложенность ключей в `uk.json` и `ru.json` считаются эталонными. Все остальные локали обязаны повторять структуру **один в один** (одинаковые пути, одинаковая глубина).
- Максимальная глубина: не более 3 уровней вложенности (например: `userSettings.profile.avatar`).
- Нейминг ключей: `lowerCamelCase`, латиница, цифры. Не используем дефисы/пробелы/спецсимволы.
- Только объекты: не используем массивы в переводах — только объектные секции.
- Плейсхолдеры: именованные параметры в фигурных скобках, например `{monthYear}`. Имена плейсхолдеров — `lowerCamelCase`.
- Плюралы: используем правила ICU/FormatJS с ветками `one`, `few`, `many`, `other` (для языков с соответствующими категориями), либо `one`/`other` — в зависимости от языка.
- Без комментариев: JSON не содержит комментарии; объяснения и примеры — только в этом файле (`locale-rules.md`).
- Альт-тексты и ARIA: текст для `alt`/`aria` обязателен там, где он используется в коде.

## Обязательная структура верхнего уровня

Следующие секции должны присутствовать во всех локалях (даже если часть ключей пока не используется):

- `common` — общие короткие строки, кнопки и статусы (например: `save`, `cancel`, `loading`).
- `layout` — строки, относящиеся к макету/навигации (`sidebar`, `alt.logo`, заголовки разделов).
- `userSettings` — всё про настройки пользователя (`profile`, `dangerZone`, `notifications`).
- `transactions` — списки, фильтры, пустые состояния, ошибки транзакций.
- `budgets` — бюджеты, карточки, пустые состояния, действия.
- `charts` — графики, оси, экспорты.
- `modals` — заголовки/кнопки модальных окон.
- `errors` — общие и специфичные ошибки (например: `uploadAvatarFailed`, `removeAvatarFailed`).
- `aiAssistant` — тексты ассистента, подсказки.
- `subscription` — платёжные планы, статусы, upgrade/unsubscribe.
- `freeTier` — подсказки и лимиты бесплатного режима.
- `forms` — поля, плейсхолдеры, валидационные сообщения.

Если добавляется новая доменная область — сначала добавляем её в `uk.json` и `ru.json`, затем синхронизируем во всех остальных локалях.

## Как правильно ссылаться на ключи в коде

Рекомендуемый подход — “сегментировать” базовый путь и ключ:

```ts
// правильно: базовый путь до секции, затем локальный ключ
const tProfile = useTranslations('userSettings.profile')
tProfile('title')            // ✓
tProfile('edit')             // ✓
tProfile('googleAccount')    // ✓
tProfile('avatar.upload')    // ✓
```

Недопустимые варианты:

- `useTranslations('userSettings.profile')` и одновременно `t('userSettings.profile.title')` — базовый путь не должен повторяться в ключе.
- Несоответствие пути и структуры JSON (например, в файле `userSettings.profile.avatar.upload` отсутствует секция `avatar`).

## Пример эталонной структуры (фрагменты)

Примеры (переводные строки условные, структура — обязательна):

```json
{
  "layout": {
    "sidebar": {
      "dashboard": "Панель",
      "transactions": "Транзакції",
      "budgets": "Бюджети",
      "userSettings": "Налаштування користувача"
    },
    "alt": {
      "logo": "Логотип Spendly"
    }
  },
  "userSettings": {
    "profile": {
      "title": "Профіль",
      "edit": "Редагувати",
      "googleAccount": "Обліковий запис Google",
      "emailAccount": "Обліковий запис Email",
      "memberSince": "Учасник з {monthYear}",
      "avatar": {
        "upload": "Завантажити аватар",
        "change": "Змінити аватар",
        "cancel": "Видалити аватар",
        "alt": "Аватар користувача"
      }
    },
    "dangerZone": {
      "title": "Небезпечна зона",
      "unsubscribe": {
        "title": "Скасувати підписку",
        "confirm": "Скасувати",
        "success": "Підписку скасовано",
        "error": "Не вдалося скасувати підписку"
      }
    }
  },
  "errors": {
    "uploadAvatarFailed": "Не вдалося завантажити аватар.",
    "removeAvatarFailed": "Не вдалося видалити аватар."
  }
}
```

Допускается использовать русскую локаль с такой же формой:

```json
{
  "userSettings": {
    "profile": {
      "memberSince": "Участник с {monthYear}"
    }
  }
}
```

## Плейсхолдеры и форматирование

- Плейсхолдеры всегда описывают смысл, а не тип: `{monthYear}`, `{count}`, `{userName}`.
- Форматирование дат/чисел делается в коде (через Intl/next-intl), а локаль получает уже отформатированное значение:
  - Пример: в коде `monthYear = new Intl.DateTimeFormat(locale, { month: 'long', year: 'numeric' }).format(createdAt)`, а в локали — `"memberSince": "Учасник з {monthYear}"`.

## Плюрализация (пример)

```json
{
  "transactions": {
    "summary": "{count, plural, one {# транзакція} few {# транзакції} many {# транзакцій} other {# транзакцій}}"
  }
}
```

Для языков без `few`/`many` используем `one`/`other`.

## Добавление новых ключей — чеклист

1. Добавьте ключи и структуру в `uk.json` и `ru.json` (канонические файлы).
2. Обновите `src/i18n/keys.ts`, если ключи перечисляются типами/литералами.
3. Скопируйте структуру во все остальные локали (значения могут быть временными/английскими).
4. Проверьте использование в коде: базовый путь в `useTranslations()` соответствует пути в JSON.
5. Запустите проверку консистентности локалей (см. ниже).
6. В PR опишите добавленные ключи и секции.

## Типичные причины “видимых ключей с точками” и как их избегать

- Неверная вложенность в JSON: ключ добавлен на неправильный уровень.
- Несовпадение пути: `useTranslations('userSettings.profile')`, но в JSON ключ лежит в `userSettings.profileX`.
- Использование полного пути в `t()` при уже установленном базовом пути.
- Пропущенный ключ в конкретной локали (структура должна быть полной в каждой локали).
- Неправильное имя плейсхолдера (в коде `{monthYear}`, в JSON `{month}`).

## Проверка локалей

Локальный скрипт проверки структуры:

```bash
node scripts/check-locales.mjs
```

Скрипт должен сообщить о пропущенных ключах и несоответствиях структуры. Если он выдаёт ошибки для, например, `hi.json`, синхронизируйте файл с эталоном (`uk.json`/`ru.json`), затем запустите проверку повторно.

## Минимальный каркас новой локали

Стартовый шаблон (копировать в новую локаль, потом наполнять значениями):

```json
{
  "common": {},
  "layout": { "sidebar": {}, "alt": {} },
  "userSettings": { "profile": { "avatar": {} }, "dangerZone": {} },
  "transactions": {},
  "budgets": {},
  "charts": {},
  "modals": {},
  "errors": {},
  "aiAssistant": {},
  "subscription": {},
  "freeTier": {},
  "forms": {}
}
```

## Рекомендации по порядку ключей

- Внутри секции ключи сортируем логически (по компонентам/подсекциям), а не строго по алфавиту.
- Стараемся держать названия иерархии параллельными UI-компонентам (например: `userSettings.profile.avatar` соответствует компоненту `ProfileCard` и его вложенной секции `AvatarUpload`).

---
Следуя этим правилам, структура локалей остаётся стабильной, новые ключи добавляются предсказуемо, а проблемы с “точками” в UI исчезают.