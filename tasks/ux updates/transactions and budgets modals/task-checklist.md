// ... existing code ...
# Чеклист: переход модалок транзакций и бюджетов на full‑screen bottom sheets

1. Аудит текущих реализаций
   - Найти места использования `Dialog` в: `src/components/modals/TransactionModal.tsx`, `src/components/modals/BudgetModal.tsx`, а также смежные `MainBudgetModal.tsx`, `EditTransactionModal.tsx`.
   - Зафиксировать текущий вызов календарей: `HybridDatePicker` и `CustomDatePicker` в `TransactionModal.tsx`, `EditTransactionModal.tsx`, `BudgetDetailsForm.tsx`.
   - Подтвердить наличие `Sheet` (Drawer) компонента: `src/components/ui/sheet.tsx`.

2. Решение по платформам
   - Для мобильной версии заменить `Dialog` на `Sheet` (Vaul/shadcn) в транзакциях и бюджетах.
   - Для десктопа сохранить `Dialog` (без изменений).
   - Определение устройства через `useDeviceType()` или проп `isMobile` от родителя.

3. Swap компонентов (мобайл)
   - В `TransactionModal.tsx`: условно рендерить `Sheet` вместо `Dialog`.
   - В `BudgetModal.tsx`: условно рендерить `Sheet` вместо `Dialog`.
   - Сохранить текущие пропсы/поведение (`title`, `onClose`, `onSubmit`, `isLoading`).

4. Конфигурация высоты и контейнера
   - Установить высоту шторки `h-[95dvh]` (или `h-full` с верхним отступом).
   - Внутри шторки использовать прокручиваемый контейнер: `overflow-y-auto`.
   - Учитывать `safe-area` через `pb-[env(safe-area-inset-bottom)]`.

5. Добавить “ручку” (DrawerHandle)
   - В верхней части `SheetContent` добавить визуальную ручку.
   - Обработать свайп для закрытия (инертность/threshold по дефолту Vaul).

6. Вложенный DatePicker как шторка
   - Конвертировать открытие календаря из поповера/портала в вторую шторку (stacked sheet).
   - Для `HybridDatePicker` добавить режим `asSheet` и рендер `Sheet` поверх текущей формы.
   - Перенести триггеры выбора даты в новую вложенную шторку.

7. Стек и z-index
   - Установить родительскую шторку с `z-[10000]`, вложенную с `z-[10010]` для уверенного перекрытия.
   - Проверить, что оверлей затемняет фон корректно и не конфликтует с `Dialog` оверлеями.

8. Управление фокусом и возвратом
   - При открытии календаря переносить фокус внутрь вложенной шторки.
   - При закрытии — возвращать фокус на поле даты в родительской форме.
   - Проверить trap/restore для screen reader (aria-modal, aria-labelledby).

9. Клавиатура и поведение viewport
   - Проверить iOS: `dvh` vs `vh` для корректного сжатия контента при показе клавиатуры.
   - Убедиться, что поля ввода не перекрываются клавиатурой (скролл к активному input).
   - Отключить прокрутку body при открытых шторках (scroll lock).

10. Точки входа/триггеры
   - `Sidebar` кнопка “Добавить транзакцию” (`window.dispatchEvent('transactions:add')`) — открыть `Sheet` на мобайле.
   - `MobileTabBar` (`Plus`) — открыть `Sheet` на мобайле.
   - Проверить универсальные хэндлеры открытия модалок.

11. UI соответствие и логику формы
   - Перенести существующую форму и валидацию без изменений.
   - Сохранить стили кнопок и состояний загрузки.
   - Проверить, что сохранение шаблона транзакции работает как прежде.

12. Локализация и тексты
   - Ничего не менять в ключах i18n, только перенести в новый контейнер.
   - Проверить заголовки, описания, aria‑лейблы.

13. Тестирование UX
   - Потоки: создание транзакции + выбор даты в вложенной шторке, создание бюджета.
   - Устройства: iOS Safari, Android Chrome, узкие экраны DevTools.
   - Сценарии: свайп‑закрытие, overlay‑клик, back‑gesture (Android), клавиатура, stacked sheets.

14. E2E/регрессия
   - Обновить/добавить e2e для открытия/закрытия шторок и выбора даты.
   - Прогнать существующие e2e (recurring rules) на предмет побочных эффектов.

15. Производительность
   - Lazy‑load календаря при открытии вложенной шторки.
   - Избежать двойного портала у старого `CustomDatePicker` (миграция в шторку).

16. Фича‑флаг (при необходимости)
   - Включить drawer‑режим через флаг для поэтапного раската.
   - Возможность быстого отката к `Dialog` на мобайле.

17. Acceptance Criteria
   - Мобайл: транзакции/бюджеты открываются как full‑screen шторки, календарь — как вложенная шторка, все фокусы/клавиатура работают.
   - Десктоп: без регрессий, все модалки остались `Dialog`, выбор даты функционален.
   - Overlay/затемнение корректны во всех состояниях (одинарная/двойная шторка).

18. Документация
   - Описать паттерн stacked sheets в `DEV.md` (когда использовать Drawer vs Dialog).
   - Краткая памятка по `dvh`, z‑index, и управлению фокусом.
// ... existing code ...